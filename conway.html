<!DOCTYPE html>
<html>
<head>
<title>Brian Tracy</title>
<style>
.cell { width: 20px; height: 20px; border-width: 0;}
.alive { background-color: green; }
.dead { background-color: white; }
</style>
<script>
document.addEventListener('DOMContentLoaded', function() {
  var WIDTH = 192 / 4;
  var HEIGHT = 108 / 4;
  var table;
  var cells;
  var resetInterval = 10 * 1000; // 10 sec
  var generationInterval = 100;  // 100 msec
  var resetTimer;
  var generationTimer;

  initTable();

  resetTimer = setInterval(reset, resetInterval)
  reset();

  function initTable() {
    table = document.getElementById('table');
    for (var y = 0; y < HEIGHT; y++) {
      var row = table.insertRow(y);
      for (var x = 0; x < WIDTH; x++) {
        var cell = row.insertCell(x);
        cell.classList.add('cell');
      }
    }
  }

  function reset() {
    clearInterval(generationTimer);
    resetCells();
    generationTimer = setInterval(playGeneration, generationInterval);
    window.stop = function () { clearInterval(generationTimer); clearInterval(resetTimer)}
  }

  function playGeneration() {
    updateTable();
    calculateLife();
    //resetCells();
  }

  function calculateLife() {
    var j = Math.random() < 0.5 ? 0 : 1
    for (var x = 0; x < WIDTH; x++) {
      for (var y = 0; y < HEIGHT; y++) {
        var ln = 0; // live neighbors
        ln += getCell(x - 1, y - 1).alive ? 1 : 0;
        ln += getCell(x - 1, y    ).alive ? 1 : 0;
        ln += getCell(x - 1, y + 1).alive ? 1 : 0;
        ln += getCell(x    , y - 1).alive ? 1 : 0;
        ln += getCell(x    , y + 1).alive ? 1 : 0;
        ln += getCell(x + 1, y - 1).alive ? 1 : 0;
        ln += getCell(x + 1, y    ).alive ? 1 : 0;
        ln += getCell(x + 1, y  + 1).alive ? 1 : 0;

        var cell = getCell(x, y);
        cell.aliveNext = (cell.alive && (ln == 2 || ln == 3)) ||
                         (!cell.alive && ln == 3);
      }
    }
    for (var x = 0; x < WIDTH; x++) {
      for (var y = 0; y < HEIGHT; y++) {
        var c = getCell(x, y);
        c.alive = c.aliveNext;
      }
    }
  }

  function resetCells() {
    cells = [];
    for (var x = 0; x < WIDTH; x++) {
      for (var y = 0; y < HEIGHT; y++) {
        setCell(x, y, { alive: Math.random() < 0.2, aliveNext: false })
      }
    }
  }

  function updateTable() {
    for (var y = 0; y < HEIGHT; y++) {
      var row = table.rows[y];
      for (var x = 0; x < WIDTH; x++) {
        row.cells[x].classList.remove('alive', 'dead');
        row.cells[x].classList.add(getCell(x, y).alive ? 'alive' : 'dead');
      }
    }
  }


  // Origin is top left
  function getCell(x, y) {
    if (x == WIDTH) x = 0;
    if (x == -1) x = WIDTH - 1;
    if (y == HEIGHT) y = 0;
    if (y == -1) y = HEIGHT - 1;
    return cells[y * WIDTH + x];
  }
  function setCell(x, y, newVal) {
    cells[y * WIDTH + x] = newVal;
  }

  function printCells() {

  }

});
</script>
<body>
<table id="table" border="0"></table>
</body>
</head>