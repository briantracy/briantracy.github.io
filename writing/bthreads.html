<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="description" content="Brian Tracy Brown University Palo Alto personal website"><title>Brian Tracy - bthreads</title><link href="data:," rel="icon"><style>main{margin-left:auto;margin-right:auto;max-width:48em}pre{background-color:#d3d3d3;padding:1em}code{background-color:#d3d3d3}footer{font-style:italic}hr{width:60%}h1,h2,h3,h4,h5{color:#006400}table{border-collapse:collapse;border-spacing:0}th,td{border:2px solid silver;padding:4px}</style></head><body><main><h1>bthreads &mdash; Bad Threading Library</h1><p>This writeup will walk through how to make an extremely barebones threading library for programs running on Linux, without support from <code>pthreads</code> or the <code>futex</code> syscall.</p><h3>Motivation</h3><p>It appears to me that implementing something badly is the first step towards implementing something well, and since I want to learn more about systems programming, I thought I would give this a shot. Mutexes are very interesting and while I have experience using them, I have only briefly considered how to create them myself.</p><p>Of course, a mutex isn't very interesting if you don't have multiple threads of control competing for it, so in order to test the mutexes I was creating, I also needed a way to create threads. This inspired the rest of the "library".</p><h3>Setup</h3><p>I wanted the following three features in <code>bthreads</code>:</p><ol type="1"><li>The ability to create threads</li><li>The ability to synchronize these threads via mutexes</li><li>The ability to join these threads</li></ol><p>This pretty much dictates the public API of <code>bthreads</code> as follows:</p><pre><code>int  bthread_create(int (*thread_func)(void *), void *thread_arg);
void bthread_collect();

void bthread_mutex_lock(bthread_mutex *mtx);
void bthread_mutex_unlock(bthread_mutex *mtx);</code></pre><p>For the sake of simplicity, joining threads is done all at once in <code>bthread_collect</code>, which should be called by the main thread before it exits.</p><h3>Creating Threads</h3><h3>Implementing Mutexes</h3><h3>Joining Threads</h3></main><footer>Last modified May 19 01:19:46 2020</footer></body></html>